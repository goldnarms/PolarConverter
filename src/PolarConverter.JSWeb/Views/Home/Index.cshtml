@{
    ViewBag.Title = "PolarConverter";
}

<div class="jumbotron">
    <p class="lead">PolarConverter converts your .xml, .hrm and .gpx files from your Polar® watch to .tcx files that can easily be imported into fitness apps such as Endomondo or Strava.</p>
    @*<p><a href="http://asp.net" class="btn btn-primary btn-large">Use Dropbox</a></p>
        <p><a href="http://asp.net" class="btn btn-primary btn-large">Upload yourself</a></p>*@
</div>

<div class="row" data-ng-app="polarApp">
    <div class="col-md-12" data-ng-controller="uploadCtrl as uc">
        <form id="fileupload" action="//jquery-file-upload.appspot.com/" method="POST" enctype="multipart/form-data" data-file-upload="uc.options" data-ng-class="{'fileupload-processing': processing() || loadingFiles}">
            <!-- Redirect browsers with JavaScript disabled to the origin page -->
            <noscript><input type="hidden" name="redirect" value="http://blueimp.github.io/jQuery-File-Upload/"></noscript>
            <!-- The fileupload-buttonbar contains buttons to add/delete files and start/cancel the upload -->
            <div class="row fileupload-buttonbar">
                <div class="col-lg-7">
                    <!-- The fileinput-button span is used to style the file input field as button -->
                    <span class="btn btn-success fileinput-button btn-sm" ng-class="{disabled: disabled}">
                        <i class="glyphicon glyphicon-plus"></i>
                        <span>Upload files...</span>
                        <input type="file" name="files[]" multiple ng-disabled="disabled">
                    </span>
                    <button type="button" class="btn btn-warning cancel btn-sm" data-ng-click="cancel()">
                        <i class="glyphicon glyphicon-ban-circle"></i>
                        <span>Cancel upload</span>
                    </button>
                    <!-- The global file processing state -->
                    <span class="fileupload-process"></span>
                </div>
                <!-- The global progress state -->
                <div class="col-lg-5 fade" data-ng-class="{in: active()}">
                    <!-- The global progress bar -->
                    <div class="progress progress-striped active" data-file-upload-progress="progress()"><div class="progress-bar progress-bar-success" data-ng-style="{width: num + '%'}"></div></div>
                    <!-- The extended global progress state -->
                    <div class="progress-extended">&nbsp;</div>
                </div>
            </div>
            <!-- The table listing the files available for upload/download -->
            <table class="table table-striped files ng-cloak">
                <tr data-ng-repeat="file in queue" data-ng-class="{'processing': file.$processing()}">
                    <td>
                        <p class="name" data-ng-switch data-on="!!file.url">
                            <span data-ng-switch-when="true" data-ng-switch data-on="!!file.thumbnailUrl">
                                <a data-ng-switch-when="true" data-ng-href="{{file.url}}" title="{{file.name}}" download="{{file.name}}" data-gallery>{{file.name}}</a>
                                <a data-ng-switch-default data-ng-href="{{file.url}}" title="{{file.name}}" download="{{file.name}}">{{file.name}}</a>
                            </span>
                            <span data-ng-switch-default>{{file.name}}</span>
                        </p>
                        <strong data-ng-show="file.error" class="error text-danger">{{file.error}}</strong>
                    </td>
                    <td>
                        <p class="size">{{file.size | formatFileSize}}</p>
                    </td>
                    <td>
                        <button type="button" class="btn btn-warning cancel btn-xs" data-ng-click="file.$cancel()" data-ng-hide="!file.$cancel">
                            <i class="glyphicon glyphicon-ban-circle"></i>
                            <span>Cancel</span>
                        </button>
                        <button data-ng-controller="fileDestroyCtrl" type="button" class="btn btn-danger destroy" data-ng-click="file.$destroy()" data-ng-hide="!file.$destroy">
                            <i class="glyphicon glyphicon-trash"></i>
                            <span>Delete</span>
                        </button>
                    </td>
                </tr>
            </table>
        </form>
        <div class="table-responsive" data-ng-show="uc.uploadedFiles.length > 0 || uc.convertedFiles.length > 0">
            <table class="table table-striped table-hover">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Filename</th>
                        <th>Sport</th>
                        <th>Gpx file</th>
                        <th>Convert</th>
                    </tr>
                </thead>
                <tr data-ng-repeat="file in uc.uploadedFiles">
                    <td>{{ $index + 1 }}</td>
                    <td>{{ file.name }}</td>
                    <td>
                        <select data-ng-model="file.sport" data-ng-options="sport for sport in uc.sports"><option value="">Select sport</option></select>
                    </td>
                    <td>
                        <span data-ng-show="file.gpxFile">{{ file.gpxFile.name}}<a href="" data-ng-click="uc.removeGpxFile(file)" title="Remove file">&nbsp;<i class="glyphicon glyphicon-remove"></i></a></span><span data-ng-hide="file.gpxFile">
                            <select data-ng-model="file.gpxFile" data-ng-options="gpxFile.name for gpxFile in uc.gpxFiles | filter: { matched: false}"><option value="">Select Gpx file</option></select>
                        </span>
                    </td>
                    <td><input type="checkbox" data-ng-checked="file.checked" /></td>
                </tr>
            </table>
            <div class="well">
                <form class="form-horizontal">
                    <legend>User profile</legend>
                    <div class="form-group">
                        <label class="col-lg-2 control-label" for="inputWeight">Weight</label>
                        <div class="col-lg-10">
                            <input type="number" step="0.1" min="1" max="900" value="" id="inputWeight" data-ng-model="uc.uploadViewModel.weight" />
                            <label>
                                <input type="radio" value="kg" data-ng-model="uc.uploadViewModel.weightMode" />&nbsp;Kg
                            </label>
                            <label>
                                <input type="radio" value="lbs" data-ng-model="uc.uploadViewModel.weightMode" />&nbsp;Lbs
                            </label>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="col-lg-2 control-label" for="inputTimeZone">
                            Timezone
                        </label>
                        <div class="col-lg-10">
                            <select id="inputTimeZone" class="form-control">
                                <option data-ng-repeat="tz in uc.timeZones" data-ng-click="uc.setTimeZoneOffset(tz)">{{tz.text}}</option>
                            </select>
                        </div>

                    </div>
                    <div class="form-group">
                        <label class="col-lg-2 control-label" for="inputForceGarmin">
                            Force Garmin device
                        </label>
                        <div class="col-lg-10"><input type="checkbox" data-ng-model="uc.uploadViewModel.forceGarmin" id="inputForceGarmin" /></div>
                    </div>
                    <div class="form-group">
                        <div class="col-lg-12">
                            <a class="btn btn-default btn-lg" data-ng-click="uc.reset(); cancel()">Cancel</a>
                            <a class="btn btn-primary btn-lg" data-ng-click="uc.convert()" data-ng-disabled="uc.isConverting">Convert</a>
                        </div>
                    </div>

                </form>
                <div class="alert alert-success" data-ng-show="uc.convertedFiles.length > 0">
                    <h3>Conversion successfull!</h3>
                    <p>Click the link to download your files</p>
                    <ul>
                        <li data-ng-repeat="file in uc.convertedFiles">
                            <i class="glyphicon glyphicon-file"></i>
                            <a data-ng-href="http://polarconverter.blob.core.windows.net/polarfiles/{{ file.reference }}">{{file.name}}</a>
                        </li>
                    </ul>
                    <br />
                </div>
                <div class="alert alert-error" data-ng-show="uc.errors.length > 0">
                    <h3>Oops, something went wrong ...</h3>
                    <p>See a list of errors below.</p>
                    <ul>
                        <li data-ng-repeat="error in uc.errors">
                            {{error}}
                        </li>
                    </ul>
                    <p>
                        The error and your files has been reported and will be investigated, but I need your e-mail so that I can give you an update when it is fixed:
                        <input type="email" value="" />
                    </p>
                    <p>Please take a look at the F.A.Q. for more information.</p>
                    <p>Any other questions? Feel free to contact me at <a href="mailto:polarconverter@gmail.com">polarconverter@gmail.com</a></p>
                    <br />
                </div>
            </div>
        </div>
    </div>
</div>
<div class="row">
    <div class="col-md-4">
        <h3>Upload</h3>
        <p>
            In order to get your .hrm and .gpx files you need to have a Polar&reg; watch that
            is compatible with Polar Pro Trainer&trade;. Export your files from the watch to
            your computer with Polar Pro Trainer&trade;, and use those files to convert with
            PolarConverter. You'll usually find your .hrm and .gpx files under C:\Users\{user}\AppData\Local\VirtualStore\Program
            Files (x86)\Polar\Polar ProTrainer\{polar user}. Xml files can be downloaded from
            your account at <a target="_blank" href="https://www.polarpersonaltrainer.com/">https://www.polarpersonaltrainer.com/.</a>
        </p>
    </div>
    <div class="col-md-4">
        <h3>Watches</h3>
        <p>
            Visit Polar's homepage to see a list of Polar Pro Trainer&trade; compatible Polar&reg;
            products:<br>
            <a target="_blank" href="http://www.polar.fi/en/support/Polar_Products_Compatible_with_Polar_ProTrainer_5?product_id=446&amp;category=faqs">Polar Pro Trainer&trade; compatible watches.</a>
        </p>
    </div>
    <div class="col-md-4">
        <h3>Questions?</h3>
        <p>
            Any questions or comments?<br>
            <a href="mailto:polarconverter@gmail.com">Contact me</a><br>
        </p>
    </div>
</div>